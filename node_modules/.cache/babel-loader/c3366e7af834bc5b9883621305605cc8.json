{"ast":null,"code":"import _regeneratorRuntime from\"/Users/abdomostafa/Finance-Tracker/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/Users/abdomostafa/Finance-Tracker/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/Users/abdomostafa/Finance-Tracker/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/abdomostafa/Finance-Tracker/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useReducer,useEffect,useState}from'react';import{db,timestamp}from'../firebase/config';//! this hook is used to do two things \n//& add new document to a collection \n//& remove document from a collection\n//! represents the response we get from firebase\nvar initialState={document:null,isPending:false,error:null,success:null};var firestoreReducer=function firestoreReducer(state,action){switch(action.type){case'IS_PENDING':return{isPending:true,document:null,success:false,error:null};case'ADDED_DOCUMENT':return{isPending:false,document:action.payload,success:true,error:null};case'DELETED_DOCUMENT':return{isPending:false,document:null,success:true,error:null};case'ERROR':return{isPending:false,document:null,success:false,error:action.payload};default:return state;}};var useFirestore=function useFirestore(){var collection=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'null';var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isCancelled=_useState2[0],setIsCancelled=_useState2[1];var _useReducer=useReducer(firestoreReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),response=_useReducer2[0],dispatch=_useReducer2[1];//! only dispatch is not cancelled\nvar dispatchIfNotCancelled=function dispatchIfNotCancelled(action){if(!isCancelled){dispatch(action);}};//! get the collection\nvar currentCollection=db.collection(collection);var addDocument=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(data){var createdAt,addedDocument;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch({type:'IS_PENDING'});_context.prev=1;createdAt=timestamp.fromDate(new Date());_context.next=5;return currentCollection.add(_objectSpread(_objectSpread({},data),{},{createdAt:createdAt}));case 5:addedDocument=_context.sent;dispatchIfNotCancelled({type:'ADDED_DOCUMENT',payload:addedDocument});_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](1);dispatchIfNotCancelled({type:'ERROR',payload:_context.t0.message});case 12:case\"end\":return _context.stop();}}},_callee,null,[[1,9]]);}));return function addDocument(_x){return _ref.apply(this,arguments);};}();var deleteDocument=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(id){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:dispatch({type:'IS_PENDING'});_context2.prev=1;_context2.next=4;return currentCollection.doc(id).delete();case 4:dispatchIfNotCancelled({type:'DELETED_DOCUMENT'});_context2.next=10;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](1);dispatchIfNotCancelled({type:'ERROR',payload:'could not delete'});case 10:case\"end\":return _context2.stop();}}},_callee2,null,[[1,7]]);}));return function deleteDocument(_x2){return _ref2.apply(this,arguments);};}();useEffect(function(){return function(){return setIsCancelled(true);};},[]);return{addDocument:addDocument,deleteDocument:deleteDocument,response:response};};export default useFirestore;","map":{"version":3,"sources":["/Users/abdomostafa/Finance-Tracker/frontend/src/hooks/useFirestore.js"],"names":["useReducer","useEffect","useState","db","timestamp","initialState","document","isPending","error","success","firestoreReducer","state","action","type","payload","useFirestore","collection","isCancelled","setIsCancelled","response","dispatch","dispatchIfNotCancelled","currentCollection","addDocument","data","createdAt","fromDate","Date","add","addedDocument","message","deleteDocument","id","doc","delete"],"mappings":"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","sourcesContent":["import {  useReducer, useEffect, useState } from 'react'\nimport {db,timestamp} from '../firebase/config'\n//! this hook is used to do two things \n//& add new document to a collection \n//& remove document from a collection\n\n//! represents the response we get from firebase\nlet initialState = {\n    document: null,\n    isPending: false,\n    error: null,\n    success: null\n}\n  \nconst firestoreReducer = (state, action) => {\n    switch (action.type) {\n      case 'IS_PENDING':\n        return { isPending: true, document: null, success: false, error: null }\n      case 'ADDED_DOCUMENT':\n        return { isPending: false, document: action.payload, success: true, error: null }\n      case 'DELETED_DOCUMENT':\n        return { isPending: false, document: null, success: true, error: null }\n      case 'ERROR':\n        return { isPending: false, document: null, success: false, error: action.payload }\n      default:\n        return state\n    }\n  }\n\nconst useFirestore = (collection='null') => {\n    const [isCancelled, setIsCancelled] = useState(false)\n    const [response,dispatch] =  useReducer(firestoreReducer, initialState)\n    \n      //! only dispatch is not cancelled\n    const dispatchIfNotCancelled = (action) => {\n        if (!isCancelled) {\n          dispatch(action)\n        }\n    }\n    //! get the collection\n    const currentCollection = db.collection(collection)\n\n\n    \n    const addDocument = async (data) => {\n        dispatch({ type: 'IS_PENDING' })\n        try {\n            const createdAt = timestamp.fromDate(new Date())\n            const addedDocument = await currentCollection.add({...data,createdAt});\n            dispatchIfNotCancelled({ type: 'ADDED_DOCUMENT', payload: addedDocument })\n        } catch (err) {\n            dispatchIfNotCancelled({ type: 'ERROR', payload: err.message })\n        }\n    \n    }\n    \n    const deleteDocument = async (id) => {\n      dispatch({ type: 'IS_PENDING' })\n      try {\n        await currentCollection.doc(id).delete()\n        dispatchIfNotCancelled({ type: 'DELETED_DOCUMENT' })\n      }\n      catch (err) {\n        dispatchIfNotCancelled({ type: 'ERROR', payload: 'could not delete' })\n      }\n    \n    }\n\n    useEffect(() => {\n        return () => setIsCancelled(true)\n    }, [])\n\n\n    return { addDocument, deleteDocument, response }\n\n}\n\nexport default useFirestore"]},"metadata":{},"sourceType":"module"}